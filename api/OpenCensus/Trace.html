<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: OpenCensus::Trace
  
    &mdash; OpenCensus
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "OpenCensus::Trace";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span>
     &raquo; 
    <span class="title">Trace</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: OpenCensus::Trace
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/opencensus/trace.rb<span class="defines">,<br />
  lib/opencensus/trace/link.rb,<br /> lib/opencensus/trace/span.rb,<br /> lib/opencensus/trace/config.rb,<br /> lib/opencensus/trace/status.rb,<br /> lib/opencensus/trace/samplers.rb,<br /> lib/opencensus/trace/exporters.rb,<br /> lib/opencensus/trace/annotation.rb,<br /> lib/opencensus/trace/formatters.rb,<br /> lib/opencensus/trace/time_event.rb,<br /> lib/opencensus/trace/integrations.rb,<br /> lib/opencensus/trace/span_builder.rb,<br /> lib/opencensus/trace/span_context.rb,<br /> lib/opencensus/trace/message_event.rb,<br /> lib/opencensus/trace/exporters/multi.rb,<br /> lib/opencensus/trace/exporters/logger.rb,<br /> lib/opencensus/trace/formatters/binary.rb,<br /> lib/opencensus/trace/integrations/rails.rb,<br /> lib/opencensus/trace/trace_context_data.rb,<br /> lib/opencensus/trace/truncatable_string.rb,<br /> lib/opencensus/trace/samplers/probability.rb,<br /> lib/opencensus/trace/samplers/never_sample.rb,<br /> lib/opencensus/trace/formatters/cloud_trace.rb,<br /> lib/opencensus/trace/samplers/always_sample.rb,<br /> lib/opencensus/trace/samplers/rate_limiting.rb,<br /> lib/opencensus/trace/formatters/trace_context.rb,<br /> lib/opencensus/trace/integrations/rack_middleware.rb,<br /> lib/opencensus/trace/integrations/faraday_middleware.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<h1 id="label-OpenCensus+Trace+API">OpenCensus Trace API</h1>

<p>This is a Ruby implementation of OpenCensus Trace, providing a common API
for latency trace tools.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Trace/Exporters.html" title="OpenCensus::Trace::Exporters (module)">Exporters</a></span>, <span class='object_link'><a href="Trace/Formatters.html" title="OpenCensus::Trace::Formatters (module)">Formatters</a></span>, <span class='object_link'><a href="Trace/Integrations.html" title="OpenCensus::Trace::Integrations (module)">Integrations</a></span>, <span class='object_link'><a href="Trace/Samplers.html" title="OpenCensus::Trace::Samplers (module)">Samplers</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Trace/Annotation.html" title="OpenCensus::Trace::Annotation (class)">Annotation</a></span>, <span class='object_link'><a href="Trace/Link.html" title="OpenCensus::Trace::Link (class)">Link</a></span>, <span class='object_link'><a href="Trace/MessageEvent.html" title="OpenCensus::Trace::MessageEvent (class)">MessageEvent</a></span>, <span class='object_link'><a href="Trace/Span.html" title="OpenCensus::Trace::Span (class)">Span</a></span>, <span class='object_link'><a href="Trace/SpanBuilder.html" title="OpenCensus::Trace::SpanBuilder (class)">SpanBuilder</a></span>, <span class='object_link'><a href="Trace/SpanContext.html" title="OpenCensus::Trace::SpanContext (class)">SpanContext</a></span>, <span class='object_link'><a href="Trace/Status.html" title="OpenCensus::Trace::Status (class)">Status</a></span>, <span class='object_link'><a href="Trace/TimeEvent.html" title="OpenCensus::Trace::TimeEvent (class)">TimeEvent</a></span>, <span class='object_link'><a href="Trace/TraceContextData.html" title="OpenCensus::Trace::TraceContextData (class)">TraceContextData</a></span>, <span class='object_link'><a href="Trace/TruncatableString.html" title="OpenCensus::Trace::TruncatableString (class)">TruncatableString</a></span>
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#configure-class_method" title="configure (class method)">.<strong>configure</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Configure OpenCensus Trace.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#end_span-class_method" title="end_span (class method)">.<strong>end_span</strong>(span)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finish the given span, which must be the span that created the current
thread-local SpanContext.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_span-class_method" title="in_span (class method)">.<strong>in_span</strong>(name, kind: nil, skip_frames: 0, sampler: nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new span in this context.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#span_context-class_method" title="span_context (class method)">.<strong>span_context</strong>  &#x21d2; SpanContext<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the current thread-local SpanContext, which governs the behavior of
the span creation class methods of OpenCensus::Trace.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#span_context=-class_method" title="span_context= (class method)">.<strong>span_context=</strong>(span_context)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the current thread-local SpanContext, which governs the behavior of
the span creation class methods of OpenCensus::Trace.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_request_trace-class_method" title="start_request_trace (class method)">.<strong>start_request_trace</strong>(trace_context: nil, same_process_as_parent: nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Starts tracing a request in the current thread, by creating a new
SpanContext and setting it as the current thread-local context.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_span-class_method" title="start_span (class method)">.<strong>start_span</strong>(name, kind: nil, skip_frames: 0, sampler: nil)  &#x21d2; SpanBuilder </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new span in the current thread-local context.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unset_span_context-class_method" title="unset_span_context (class method)">.<strong>unset_span_context</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Unsets the current thread-local SpanContext, disabling span creation class
methods of OpenCensus::Trace.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="configure-class_method">
  
    .<strong>configure</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Configure OpenCensus Trace. These configuration fields include parameters
governing sampling, span creation, and exporting.</p>

<p>This configuration is also available as the <code>trace</code> subconfig
under the main configuration <code>OpenCensus.configure</code>. If the
OpenCensus Railtie is installed in a Rails application, the configuration
object is also exposed as <code>config.opencensus.trace</code>.</p>

<p>Generally, you should configure this once at process initialization, but it
can be modified at any time.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_default_sampler'>default_sampler</span> <span class='op'>=</span>
    <span class='const'><span class='object_link'><a href="../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/Samplers.html" title="OpenCensus::Trace::Samplers (module)">Samplers</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/Samplers/RateLimiting.html" title="OpenCensus::Trace::Samplers::RateLimiting (class)">RateLimiting</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Trace/Samplers/RateLimiting.html#initialize-instance_method" title="OpenCensus::Trace::Samplers::RateLimiting#initialize (method)">new</a></span></span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_default_max_attributes'>default_max_attributes</span> <span class='op'>=</span> <span class='int'>16</span>
<span class='kw'>end</span>
</code></pre>

<p>Supported fields are:</p>
<ul><li>
<p><code>default_sampler</code> The default sampler to use. Must be a sampler,
an object with a <code>call</code> method that takes a single options hash.
See <span class='object_link'><a href="Trace/Samplers.html" title="OpenCensus::Trace::Samplers (module)">Samplers</a></span>. The initial value is an instance of
<span class='object_link'><a href="Trace/Samplers/AlwaysSample.html" title="OpenCensus::Trace::Samplers::AlwaysSample (class)">OpenCensus::Trace::Samplers::AlwaysSample</a></span>.</p>
</li><li>
<p><code>exporter</code> The exporter to use. Must be an exporter, an object
with an export method that takes an array of Span objects. See
<span class='object_link'><a href="Trace/Exporters.html" title="OpenCensus::Trace::Exporters (module)">Exporters</a></span>. The initial value is a
<span class='object_link'><a href="Trace/Exporters/Logger.html" title="OpenCensus::Trace::Exporters::Logger (class)">OpenCensus::Trace::Exporters::Logger</a></span> that logs to STDOUT.</p>
</li><li>
<p><code>http_formatter</code> The trace context propagation formatter to use.
Must be a formatter, an object with <code>serialize</code>,
<code>deserialize</code>, <code>header_name</code>, and
<code>rack_header_name</code> methods. See <span class='object_link'><a href="Trace/Formatters.html" title="OpenCensus::Trace::Formatters (module)">Formatters</a></span>.
The initial value is a <span class='object_link'><a href="Trace/Formatters/TraceContext.html" title="OpenCensus::Trace::Formatters::TraceContext (class)">OpenCensus::Trace::Formatters::TraceContext</a></span>.</p>
</li><li>
<p><code>default_max_attributes</code> The maximum number of attributes to add
to a span. Initial value is 32. Use 0 for no maximum.</p>
</li><li>
<p><code>default_max_stack_frames</code> The maximum number of stack frames to
represent in a span&#39;s stack trace. Initial value is 32. Use 0 for no
maximum.</p>
</li><li>
<p><code>default_max_annotations</code> The maximum number of annotations to
add to a span. Initial value is 32. Use 0 for no maximum.</p>
</li><li>
<p><code>default_max_message_events</code> The maximum number of message
events to add to a span. Initial value is 128. Use 0 for no maximum.</p>
</li><li>
<p><code>default_max_links</code> The maximum number of links to add to a
span. Initial value is 128. Use 0 for no maximum.</p>
</li><li>
<p><code>default_max_string_length</code> The maximum length of string fields.
Initial value is 1024. Use 0 for no maximum.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace/config.rb', line 105</span>

<span class='kw'>def</span> <span class='id identifier rubyid_configure'>configure</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>yield</span> <span class='ivar'>@config</span>
  <span class='kw'>else</span>
    <span class='ivar'>@config</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="end_span-class_method">
  
    .<strong>end_span</strong>(span)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finish the given span, which must be the span that created the current
thread-local SpanContext. Also updates the thread-local SpanContext so
subsequent calls no longer create subspans of the finished span.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>span</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/SpanBuilder.html" title="OpenCensus::Trace::SpanBuilder (class)">SpanBuilder</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The expected currently active span to finish.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200
201
202
203
204
205
206
207</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace.rb', line 198</span>

<span class='kw'>def</span> <span class='id identifier rubyid_end_span'>end_span</span> <span class='id identifier rubyid_span'>span</span>
  <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_span_context'>span_context</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No currently active span context</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_context'>context</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_span'>span</span><span class='period'>.</span><span class='id identifier rubyid_equal?'>equal?</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_this_span'>this_span</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The given span doesn&#39;t match the currently active span</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_span'>span</span><span class='period'>.</span><span class='id identifier rubyid_finish!'>finish!</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_span_context'>span_context</span> <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span>
  <span class='id identifier rubyid_span'>span</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="in_span-class_method">
  
    .<strong>in_span</strong>(name, kind: nil, skip_frames: 0, sampler: nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new span in this context. You must pass a name for the span. All
other span attributes should be set using <span class='object_link'><a href="Trace/SpanBuilder.html" title="OpenCensus::Trace::SpanBuilder (class)">SpanBuilder</a></span>
methods.</p>

<p>The span will be started automatically with the current timestamp. The
SpanBuilder will then be passed to the block you provide. The span will be
finished automatically at the end of the block. Within the block, the
thread-local SpanContext will be updated so calls to
<code>start_span</code> will create subspans.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Name of the span. Required.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>kind</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Kind of span. Optional. Defaults to unspecified. Other allowed values are
<span class='object_link'><a href="Trace/SpanBuilder.html#SERVER-constant" title="OpenCensus::Trace::SpanBuilder::SERVER (constant)">OpenCensus::Trace::SpanBuilder::SERVER</a></span> and
<span class='object_link'><a href="Trace/SpanBuilder.html#CLIENT-constant" title="OpenCensus::Trace::SpanBuilder::CLIENT (constant)">OpenCensus::Trace::SpanBuilder::CLIENT</a></span>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sampler</span>
      
      
        <span class='type'>(<tt>Sampler</tt>, <tt>Boolean</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Span-scoped sampler. Optional. If provided, the sampler may be a sampler
object as defined in the <span class='object_link'><a href="Trace/Samplers.html" title="OpenCensus::Trace::Samplers (module)">Samplers</a></span> module docs, or the
values <code>true</code> or <code>false</code> as shortcuts for
<span class='object_link'><a href="Trace/Samplers/AlwaysSample.html" title="OpenCensus::Trace::Samplers::AlwaysSample (class)">OpenCensus::Trace::Samplers::AlwaysSample</a></span> or
<span class='object_link'><a href="Trace/Samplers/NeverSample.html" title="OpenCensus::Trace::Samplers::NeverSample (class)">OpenCensus::Trace::Samplers::NeverSample</a></span>, respectively. If no span-scoped
sampler is provided, the local parent span&#39;s sampling decision is used.
If there is no local parent span, the configured default sampler is used to
make a sampling decision.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace.rb', line 180</span>

<span class='kw'>def</span> <span class='id identifier rubyid_in_span'>in_span</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>skip_frames:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>sampler:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_span'>span</span> <span class='op'>=</span> <span class='id identifier rubyid_start_span'>start_span</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span> <span class='label'>skip_frames:</span> <span class='id identifier rubyid_skip_frames'>skip_frames</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
                          <span class='label'>sampler:</span> <span class='id identifier rubyid_sampler'>sampler</span>
  <span class='kw'>begin</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_span'>span</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_end_span'>end_span</span> <span class='id identifier rubyid_span'>span</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="span_context-class_method">
  
    .<strong>span_context</strong>  &#x21d2; <tt><span class='object_link'><a href="Trace/SpanContext.html" title="OpenCensus::Trace::SpanContext (class)">SpanContext</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the current thread-local SpanContext, which governs the behavior of
the span creation class methods of OpenCensus::Trace. Returns
<code>nil</code> if there is no current SpanContext.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/SpanContext.html" title="OpenCensus::Trace::SpanContext (class)">SpanContext</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_span_context'>span_context</span>
  <span class='const'><span class='object_link'><a href="../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Context.html" title="OpenCensus::Context (module)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="Context.html#get-class_method" title="OpenCensus::Context.get (method)">get</a></span></span> <span class='const'>SPAN_CONTEXT_KEY</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="span_context=-class_method">
  
    .<strong>span_context=</strong>(span_context)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the current thread-local SpanContext, which governs the behavior of
the span creation class methods of OpenCensus::Trace.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>span_context</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/SpanContext.html" title="OpenCensus::Trace::SpanContext (class)">SpanContext</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_span_context='>span_context=</span> <span class='id identifier rubyid_span_context'>span_context</span>
  <span class='const'><span class='object_link'><a href="../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Context.html" title="OpenCensus::Context (module)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'><span class='object_link'><a href="Context.html#set-class_method" title="OpenCensus::Context.set (method)">set</a></span></span> <span class='const'>SPAN_CONTEXT_KEY</span><span class='comma'>,</span> <span class='id identifier rubyid_span_context'>span_context</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_request_trace-class_method">
  
    .<strong>start_request_trace</strong>(trace_context: nil, same_process_as_parent: nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Starts tracing a request in the current thread, by creating a new
SpanContext and setting it as the current thread-local context. Generally
you should call this when beginning the handling of a request. If there is
a rack environment or a provided traceparent header, pass it in so the
SpanContext is constructed accordingly.</p>

<p>If you pass a block, this method will yield the SpanContext to the block.
When the block finishes, the span context will automatically be unset. If
you do not pass a block, this method will return the SpanContext. You must
then call <code>unset_span_context</code> yourself at the end of the
request</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>trace_context</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/TraceContextData.html" title="OpenCensus::Trace::TraceContextData (class)">TraceContextData</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The request&#39;s incoming trace context (optional)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>same_process_as_parent</span>
      
      
        <span class='type'>(<tt>boolean</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Set to <code>true</code> if the parent span is local, <code>false</code> if
it is remote, or <code>nil</code> if there is no parent span or this
information is not available.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


97
98
99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace.rb', line 97</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_request_trace'>start_request_trace</span> <span class='label'>trace_context:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>same_process_as_parent:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_span_context'>span_context</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Trace/SpanContext.html" title="OpenCensus::Trace::SpanContext (class)">SpanContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create_root'><span class='object_link'><a href="Trace/SpanContext.html#create_root-class_method" title="OpenCensus::Trace::SpanContext.create_root (method)">create_root</a></span></span> \
    <span class='label'>trace_context:</span> <span class='id identifier rubyid_trace_context'>trace_context</span><span class='comma'>,</span>
    <span class='label'>same_process_as_parent:</span> <span class='id identifier rubyid_same_process_as_parent'>same_process_as_parent</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_span_context'>span_context</span> <span class='op'>=</span> <span class='id identifier rubyid_span_context'>span_context</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_span_context'>span_context</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_unset_span_context'>unset_span_context</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_span_context'>span_context</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_span-class_method">
  
    .<strong>start_span</strong>(name, kind: nil, skip_frames: 0, sampler: nil)  &#x21d2; <tt><span class='object_link'><a href="Trace/SpanBuilder.html" title="OpenCensus::Trace::SpanBuilder (class)">SpanBuilder</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new span in the current thread-local context. You must pass a name
for the span. All other span attributes should be set using
<span class='object_link'><a href="Trace/SpanBuilder.html" title="OpenCensus::Trace::SpanBuilder (class)">SpanBuilder</a></span> methods.</p>

<p>The span will be started automatically with the current timestamp. However,
you are responsible for finishing the span yourself. Furthermore, the
current thread-local SpanContext will be updated so subsequent calls to
<code>start_span</code> will create spans within the new span.</p>

<p>You should always match <code>start_span</code> calls with a corresponding
call to <code>end_span</code>, which finishes the span and updates the
SpanContext accordingly. If you want this done automatically, consider
using the <code>in_span</code> method.</p>

<p>Will throw an exception if there is no current SpanContext.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Name of the span. Required.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>kind</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Kind of span. Optional. Defaults to unspecified. Other allowed values are
<span class='object_link'><a href="Trace/SpanBuilder.html#SERVER-constant" title="OpenCensus::Trace::SpanBuilder::SERVER (constant)">OpenCensus::Trace::SpanBuilder::SERVER</a></span> and
<span class='object_link'><a href="Trace/SpanBuilder.html#CLIENT-constant" title="OpenCensus::Trace::SpanBuilder::CLIENT (constant)">OpenCensus::Trace::SpanBuilder::CLIENT</a></span>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sampler</span>
      
      
        <span class='type'>(<tt>Sampler</tt>, <tt>Boolean</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Span-scoped sampler. Optional. If provided, the sampler may be a sampler
object as defined in the <span class='object_link'><a href="Trace/Samplers.html" title="OpenCensus::Trace::Samplers (module)">Samplers</a></span> module docs, or the
values <code>true</code> or <code>false</code> as shortcuts for
<span class='object_link'><a href="Trace/Samplers/AlwaysSample.html" title="OpenCensus::Trace::Samplers::AlwaysSample (class)">OpenCensus::Trace::Samplers::AlwaysSample</a></span> or
<span class='object_link'><a href="Trace/Samplers/NeverSample.html" title="OpenCensus::Trace::Samplers::NeverSample (class)">OpenCensus::Trace::Samplers::NeverSample</a></span>, respectively. If no span-scoped
sampler is provided, the local parent span&#39;s sampling decision is used.
If there is no local parent span, the configured default sampler is used to
make a sampling decision.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/SpanBuilder.html" title="OpenCensus::Trace::SpanBuilder (class)">SpanBuilder</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A SpanBuilder object that you can use to set span attributes and create
children.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


146
147
148
149
150
151
152
153
154</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace.rb', line 146</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_span'>start_span</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>skip_frames:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>sampler:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_span_context'>span_context</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No currently active span context</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_context'>context</span>
  <span class='id identifier rubyid_span'>span</span> <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_start_span'>start_span</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span>
                                  <span class='label'>skip_frames:</span> <span class='id identifier rubyid_skip_frames'>skip_frames</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
                                  <span class='label'>sampler:</span> <span class='id identifier rubyid_sampler'>sampler</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_span_context'>span_context</span> <span class='op'>=</span> <span class='id identifier rubyid_span'>span</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span>
  <span class='id identifier rubyid_span'>span</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unset_span_context-class_method">
  
    .<strong>unset_span_context</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Unsets the current thread-local SpanContext, disabling span creation class
methods of OpenCensus::Trace</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unset_span_context'>unset_span_context</span>
  <span class='const'><span class='object_link'><a href="../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Context.html" title="OpenCensus::Context (module)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unset'><span class='object_link'><a href="Context.html#unset-class_method" title="OpenCensus::Context.unset (method)">unset</a></span></span> <span class='const'>SPAN_CONTEXT_KEY</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Oct 14 17:55:20 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.20 (ruby-2.5.3).
</div>

    </div>
  </body>
</html>